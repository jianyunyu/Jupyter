
% Default to the notebook output style

    


% Inherit from the specified cell style.




    
\documentclass[11pt]{article}

    
    
    \usepackage[T1]{fontenc}
    % Nicer default font (+ math font) than Computer Modern for most use cases
    \usepackage{mathpazo}

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % We will generate all images so they have a width \maxwidth. This means
    % that they will get their normal width if they fit onto the page, but
    % are scaled down if they would overflow the margins.
    \makeatletter
    \def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth
    \else\Gin@nat@width\fi}
    \makeatother
    \let\Oldincludegraphics\includegraphics
    % Set max figure width to be 80% of text width, for now hardcoded.
    \renewcommand{\includegraphics}[1]{\Oldincludegraphics[width=.8\maxwidth]{#1}}
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionLabelFormat{nolabel}{}
    \captionsetup{labelformat=nolabel}

    \usepackage{adjustbox} % Used to constrain images to a maximum size 
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro
    \usepackage[mathletters]{ucs} % Extended unicode (utf-8) support
    \usepackage[utf8x]{inputenc} % Allow utf-8 characters in the tex document
    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics 
                         % to support a larger range 
    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    

    
    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}
    
    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    
    
    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatability definitions
    \def\gt{>}
    \def\lt{<}
    % Document parameters
    \title{SIAC\_Filtering}
    
    
    

    % Pygments definitions
    
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\expandafter\def\csname PY@tok@w\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\expandafter\def\csname PY@tok@c\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.74,0.48,0.00}{##1}}}
\expandafter\def\csname PY@tok@k\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\expandafter\def\csname PY@tok@o\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ow\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@nb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@ne\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.82,0.25,0.23}{##1}}}
\expandafter\def\csname PY@tok@nv\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@no\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@nl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@ni\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.60,0.60,0.60}{##1}}}
\expandafter\def\csname PY@tok@na\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.49,0.56,0.16}{##1}}}
\expandafter\def\csname PY@tok@nt\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@s\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sd\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@si\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@se\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.13}{##1}}}
\expandafter\def\csname PY@tok@sr\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@ss\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sx\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@m\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@gh\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gu\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@gi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@gr\endcsname{\def\PY@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@ge\endcsname{\let\PY@it=\textit}
\expandafter\def\csname PY@tok@gs\endcsname{\let\PY@bf=\textbf}
\expandafter\def\csname PY@tok@gp\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@go\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.53,0.53}{##1}}}
\expandafter\def\csname PY@tok@gt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\expandafter\def\csname PY@tok@err\endcsname{\def\PY@bc##1{\setlength{\fboxsep}{0pt}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}
\expandafter\def\csname PY@tok@kc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kd\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kr\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@bp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@fm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@vc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vg\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sa\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@dl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s2\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s1\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@mb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@il\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mo\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ch\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cm\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cpf\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@c1\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cs\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % Exact colors from NB
    \definecolor{incolor}{rgb}{0.0, 0.0, 0.5}
    \definecolor{outcolor}{rgb}{0.545, 0.0, 0.0}



    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy 
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

    \begin{document}
    
    
    \maketitle
    
    

    
    \section{Tutorial of SIAC Filtering}\label{tutorial-of-siac-filtering}

This tutorial by Xiaozhou Li is licensed under a Creative Commons
Attribution 4.0 International License.\\
All code examples are also licensed under the
\href{http://opensource.org/licenses/MIT}{MIT license}.

    \subsection{What is SIAC Filtering}\label{what-is-siac-filtering}

A standard definition of SIAC Filtering is a B-spline based convolution
processing technique. The name SIAC means Smoothness-Increasing
Accuracy-Conserving. The formulation can be written as
\[ u_h^{\star}(x, T) = (K_h\star u_h)(x, T) = \int_{-\infty}^{\infty}K_h(x - \xi)u_h(\xi, T) d\xi, \]
where \(K_h\) is the so-called SIAC filter.

    \subsection{A Review of B-spline}\label{a-review-of-b-spline}

First, we recall the definition of B-splines given by de Boor
\cite{Boor:2001}.

\textbf{B-spline}

Let \(\mathbf{t}:= (t_j)\) be a \textbf{nondecreasing sequence} of real
numbers that create a so-called knot sequence. The \(j\)th B-spline of
order \(\ell\) for the knot sequence \(\mathbf{t}\) is denoted by
\(B_{j,\ell,\mathbf{t}}\) and is defined, for \(\ell=1\), by the rule

\begin{equation}
    B_{j,1,\mathbf{t}}(x) =
        \left\{\begin{array}{ll}
        1, & t_j \leq x < t_{j+1}; \\
        0, & \text{otherwise}.
        \end{array} \right.
\end{equation}

In particular, \(t_j = t_{j+1}\) leads to \(B_{j,1,\mathbf{t}} = 0.\)
For \(\ell > 1\),

\begin{align*}
 B_{j,\ell,\mathbf{t}}(x)
= \omega_{j,k,\mathbf{t}}B_{j,\ell-1,\mathbf{t}} +
(1 - \omega_{j+1,\ell,\mathbf{t}})B_{j+1,\ell-1,\mathbf{t}},
\end{align*}

with
\[ \omega_{j,\ell,\mathbf{t}}(x) = \frac{x-t_j}{t_{j+\ell-1}-t_{j}}.\]

    \begin{itemize}
\tightlist
\item
  The knot sequence \(\mathbf{t}\) also represents the so-called breaks
  of the B-spline.
\item
  The B-spline in the region \([t_i, t_{i+1}),\, i = 0,\ldots,\ell-1\)
  is a polynomial of degree \(\ell-1\), but in the entire support
  \([t_0,t_{\ell}]\), the B-spline is a piecewise polynomial.
\item
  When the knots \((t_j)\) are sampled in a symmetric and equidistant
  fashion, the B-spline is called a central B-spline.
\end{itemize}

\textbf{Central B-spline}

A central B-spline of order \(\ell\) has a knot sequence that is
uniformly spaced and symmetrically distributed
\[\mathbf{t}=-\frac{\ell}{2},-\frac{\ell-2}{2},\cdots,\frac{\ell-2}{2},\frac{\ell}{2}.\]
For convenience, we denote \(\psi_{\mathbf{t}}^{(\ell)}(x)\) to be the
\(0^{th}\) B-spline of order \(\ell\) for the knot sequence
\(\mathbf{t}\),
\[\psi_{\mathbf{t}}^{(\ell)}(x) = B_{0,\ell,\mathbf{t}}(x).\]

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}1}]:} \PY{c+c1}{\PYZsh{} environment setting, before any codes}
        \PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
        \PY{k+kn}{import} \PY{n+nn}{numpy}\PY{n+nn}{.}\PY{n+nn}{polynomial}\PY{n+nn}{.}\PY{n+nn}{legendre} \PY{k}{as} \PY{n+nn}{npleg}
        \PY{o}{\PYZpc{}}\PY{k}{matplotlib} inline
        \PY{o}{\PYZpc{}}\PY{k}{config} InlineBackend.figure\PYZus{}format = \PYZsq{}retina\PYZsq{}
        \PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{pyplot} \PY{k}{as} \PY{n+nn}{plt}
        \PY{k+kn}{from} \PY{n+nn}{ipywidgets} \PY{k}{import} \PY{n}{interact}\PY{p}{,} \PY{n}{interactive}\PY{p}{,} \PY{n}{fixed}\PY{p}{,} \PY{n}{interact\PYZus{}manual}
        \PY{k+kn}{import} \PY{n+nn}{ipywidgets} \PY{k}{as} \PY{n+nn}{widgets}
        \PY{k+kn}{from} \PY{n+nn}{IPython}\PY{n+nn}{.}\PY{n+nn}{display} \PY{k}{import} \PY{n}{clear\PYZus{}output}\PY{p}{,} \PY{n}{display}
\end{Verbatim}


    \subsubsection{Implementing of
B-splines}\label{implementing-of-b-splines}

Here, we adopt de Boor's algorithm B-spline to implement B-spline

\begin{Shaded}
\begin{Highlighting}[]
    \KeywordTok{def}\NormalTok{ bspline(x, order, T)}
\end{Highlighting}
\end{Shaded}

where - \(x\): the evaluation point - \(order\): the order of B-spline
(polynomial degree \(= order-1\)) - \(T\): \(T[0], \ldots, T[order]\)
the nodes b-spline Note: - One has to be careful once the evaluation
point \(x\) is located at the end nodes of the B-spline. It is the
reason to introduce the \(tiny\) variable\$.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}2}]:} \PY{k}{def} \PY{n+nf}{bspline}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{order}\PY{p}{,} \PY{n}{T}\PY{p}{)}\PY{p}{:}
            \PY{n}{tiny} \PY{o}{=} \PY{l+m+mf}{1.e\PYZhy{}13}
            \PY{k}{if} \PY{p}{(}\PY{n}{x} \PY{o}{\PYZlt{}} \PY{n}{T}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{\PYZhy{}}\PY{n}{tiny} \PY{o+ow}{or} \PY{n}{x} \PY{o}{\PYZgt{}} \PY{n}{T}\PY{p}{[}\PY{n}{order}\PY{p}{]}\PY{o}{+}\PY{n}{tiny}\PY{p}{)}\PY{p}{:}
                \PY{k}{return} \PY{l+m+mf}{0.}
            \PY{k}{else}\PY{p}{:}
                \PY{k}{if} \PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{x} \PY{o}{\PYZhy{}} \PY{n}{T}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{p}{)} \PY{o}{\PYZlt{}} \PY{n}{tiny}\PY{p}{:}
                    \PY{n}{x} \PY{o}{=} \PY{n}{T}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{+} \PY{l+m+mi}{2}\PY{o}{*}\PY{n}{tiny}
                \PY{k}{if} \PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{x} \PY{o}{\PYZhy{}} \PY{n}{T}\PY{p}{[}\PY{n}{order}\PY{p}{]}\PY{p}{)}\PY{p}{)} \PY{o}{\PYZlt{}} \PY{n}{tiny}\PY{p}{:}
                    \PY{n}{x} \PY{o}{=} \PY{n}{T}\PY{p}{[}\PY{n}{order}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{l+m+mi}{2}\PY{o}{*}\PY{n}{tiny} 
                \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{order}\PY{p}{)}\PY{p}{:}
                    \PY{k}{if} \PY{p}{(}\PY{n}{x} \PY{o}{\PYZgt{}}\PY{o}{=} \PY{n}{T}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{\PYZhy{}}\PY{n}{tiny} \PY{o+ow}{and} \PY{n}{x} \PY{o}{\PYZlt{}} \PY{n}{T}\PY{p}{[}\PY{n}{i}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{\PYZhy{}}\PY{n}{tiny}\PY{p}{)}\PY{p}{:}
                        \PY{n}{left} \PY{o}{=} \PY{n}{i}
                        \PY{k}{break}
                \PY{n}{B1} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n}{order}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}
                \PY{n}{B1}\PY{p}{[}\PY{n}{left}\PY{p}{]} \PY{o}{=} \PY{l+m+mf}{1.}
                \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{order}\PY{p}{)}\PY{p}{:}
                    \PY{n}{B2} \PY{o}{=} \PY{n}{B1}
                    \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{n}{order}\PY{o}{\PYZhy{}}\PY{n}{i}\PY{p}{)}\PY{p}{:}
                        \PY{k}{if} \PY{p}{(}\PY{n}{B2}\PY{p}{[}\PY{n}{j}\PY{p}{]} \PY{o}{\PYZlt{}} \PY{n}{tiny}\PY{p}{)}\PY{p}{:}
                            \PY{n}{termL} \PY{o}{=} \PY{l+m+mf}{0.}
                        \PY{k}{else}\PY{p}{:}
                            \PY{n}{termL} \PY{o}{=} \PY{p}{(}\PY{n}{x} \PY{o}{\PYZhy{}} \PY{n}{T}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{)}\PY{o}{/}\PY{p}{(}\PY{n}{T}\PY{p}{[}\PY{n}{i}\PY{o}{+}\PY{n}{j}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{T}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{)}\PY{o}{*}\PY{n}{B2}\PY{p}{[}\PY{n}{j}\PY{p}{]}
                        \PY{k}{if} \PY{p}{(}\PY{n}{B2}\PY{p}{[}\PY{n}{j}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZlt{}} \PY{n}{tiny}\PY{p}{)}\PY{p}{:}
                            \PY{n}{termR} \PY{o}{=} \PY{l+m+mf}{0.}
                        \PY{k}{else}\PY{p}{:}
                            \PY{n}{termR} \PY{o}{=} \PY{p}{(}\PY{n}{T}\PY{p}{[}\PY{n}{i}\PY{o}{+}\PY{n}{j}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{x}\PY{p}{)}\PY{o}{/}\PY{p}{(}\PY{n}{T}\PY{p}{[}\PY{n}{i}\PY{o}{+}\PY{n}{j}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{T}\PY{p}{[}\PY{n}{j}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{o}{*}\PY{n}{B2}\PY{p}{[}\PY{n}{j}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}
                        \PY{n}{B1}\PY{p}{[}\PY{n}{j}\PY{p}{]} \PY{o}{=} \PY{n}{termL} \PY{o}{+} \PY{n}{termR}
                \PY{k}{return} \PY{n}{B1}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}3}]:} \PY{k}{def} \PY{n+nf}{plot\PYZus{}bspline}\PY{p}{(}\PY{n}{order}\PY{p}{,}\PY{n}{T}\PY{p}{)}\PY{p}{:}
            \PY{n}{samples} \PY{o}{=} \PY{l+m+mi}{21}
            \PY{n}{tiny} \PY{o}{=} \PY{l+m+mf}{1.e\PYZhy{}13}
            \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{size}\PY{p}{(}\PY{n}{T}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:}
                \PY{k}{if} \PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{T}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{T}\PY{p}{[}\PY{n}{i}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)} \PY{o}{\PYZgt{}} \PY{n}{tiny}\PY{p}{)}\PY{p}{:}
                    \PY{n}{x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{T}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{T}\PY{p}{[}\PY{n}{i}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{samples}\PY{p}{)}
                    \PY{n}{y} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n}{samples}\PY{p}{)}
                    \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{samples}\PY{p}{)}\PY{p}{:}
                        \PY{n}{y}\PY{p}{[}\PY{n}{j}\PY{p}{]} \PY{o}{=} \PY{n}{bspline}\PY{p}{(}\PY{n}{x}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{,} \PY{n}{order}\PY{p}{,} \PY{n}{T}\PY{p}{)}
                    \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{y}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}.r}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{linewidth}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
        
        \PY{n}{order} \PY{o}{=} \PY{l+m+mi}{4}
        \PY{n}{T1} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{2}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{]}\PY{p}{)}
        \PY{n}{T2} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{]}\PY{p}{)}
        \PY{n}{plot\PYZus{}bspline}\PY{p}{(}\PY{n}{order}\PY{p}{,}\PY{n}{T1}\PY{p}{)}
        \PY{n}{plot\PYZus{}bspline}\PY{p}{(}\PY{n}{order}\PY{p}{,}\PY{n}{T2}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_7_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \subsection{Construction of the Simplest SIAC
Filter}\label{construction-of-the-simplest-siac-filter}

In the early literatures like \cite{Bramble:1977} and
\cite{Cockburn:2003}, the classic filter is defined as

\begin{equation}
    K^{(2k+1,k+1)}(x) = \sum\limits_{\gamma=0}^{2k}c^{(2k+1,k+1)}_{\gamma}\psi^{(k+1)}\left(x - x_\gamma\right),
\end{equation}

where \(x_\gamma = \gamma - k\) and \(\psi^{(k+1)}\) is the \((k+1)\)th
order \textbf{central B-spline}. The scaled filter used for filtering is
given by
\[ K_h^{(2k+1,k+1)}(x) = \frac{1}{h}K^{(2k+1,k+1)}\left(\frac{x}{h}\right). \]
Here, we follow the extensions in \cite{Li:2015} for a more general
framework

\begin{equation}
    K^{(r+1,\ell)}(x) = \sum\limits_{\gamma=0}^{r}c^{(r+1,\ell)}_{\gamma}\psi^{\ell}\left(x - \eta x_\gamma\right),
\end{equation}

where \(x_\gamma = \eta\left(\gamma - \frac{r}{2}\right)\) and
\(\psi^{\ell}\) is the \(\ell\)th order \textbf{central B-spline}.
Furthermore, \(r+1\) is the number of B-splines and \(\eta\) is the
compression factor.

    \subsubsection{The nodes matrix}\label{the-nodes-matrix}

To design a general framework to construct the filter, we introduce the
concept of nodes matrix.

\textbf{nodes matrix:}

A nodes matrix, \(T\), is an \((r+1) \times (\ell+1)\) matrix such that
the \(\gamma-\)th row, \(T[\gamma,:]\), of the matrix \(T\) is a nodes
sequence with \(\ell+1\) elements that are used to create the B-spline
\(\psi_{T[\gamma,:]}^{\ell}(x)\). The number of rows \(r+1\) is
specified based on the number of B-splines used to construct the filter.

As we mensioned before, the \(\ell\)th order central B-spline has the
nodes sequence
\[\left[-\frac{\ell}{2},-\frac{\ell-2}{2},\cdots,\frac{\ell-2}{2},\frac{\ell}{2}\right],\]
which leads
\[T[\gamma,:] = \eta x_\gamma + \left[-\frac{\ell}{2},-\frac{\ell-2}{2},\cdots,\frac{\ell-2}{2},\frac{\ell}{2}\right],\]
or \[T[j, i] = i - \frac{\ell}{2} + \eta \left(j - \frac{r}{2}\right).\]

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}4}]:} \PY{k}{def} \PY{n+nf}{generate\PYZus{}nodes\PYZus{}T}\PY{p}{(}\PY{n}{num}\PY{p}{,} \PY{n}{order}\PY{p}{,} \PY{n}{compress}\PY{p}{)}\PY{p}{:}
            \PY{n}{T} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{p}{[}\PY{n}{num}\PY{p}{,}\PY{n}{order}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
            \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{num}\PY{p}{)}\PY{p}{:}
                \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{order}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:}
                    \PY{n}{T}\PY{p}{[}\PY{n}{j}\PY{p}{,}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mf}{0.5}\PY{o}{*}\PY{n}{order} \PY{o}{+} \PY{n}{compress}\PY{o}{*}\PY{p}{(}\PY{n}{j} \PY{o}{\PYZhy{}} \PY{l+m+mf}{0.5}\PY{o}{*}\PY{p}{(}\PY{n}{num}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
            \PY{k}{return} \PY{n}{T}
        \PY{c+c1}{\PYZsh{}\PYZsh{}k = 1}
        \PY{c+c1}{\PYZsh{}\PYZsh{}print (generate\PYZus{}nodes\PYZus{}T(2*k+1, k+1, 1))}
\end{Verbatim}


    \subsubsection{Coefficient}\label{coefficient}

After defined the B-splines used to construct the filter, the only thing
remains is to decide the coefficient,
\(\left\{c^{(r+1,\ell)}_\gamma\right\}_{\gamma=0}^r\). The coefficients
are decided by implementing the property that the filter reproduces
polynomials by convolution up to degree \(r\),

\begin{equation}
    K^{(r+1,\ell)} \star p = p, \quad p = 0, x, ..., x^{r}.
\end{equation}

Using the monomials as in the above equation we can obtain the following
linear system for the filter coefficients:

\begin{equation}
    \sum\limits_{\gamma=0}^{r} c_\gamma^{(r+1,\ell)}\int_{-\infty}^\infty \psi^{(\ell)}(\xi - x_\gamma)(x - \xi)^m d\xi = x^m, \,\, m = 0, 1,\ldots,r.
\end{equation}

In order to calculate the integration exactly, we use Gaussian
quadrature with \(\lceil\frac{\ell+m+1}{2}\rceil\) quadrature points. As
an example for \(k=1\) (\(r = 2k, \ell=k+1\)), we have

\begin{equation}
    \label{eq-Matrix}
    \left[
        \begin{array}{ccc}
            1 & 1 & 1\\
            x-1& x & x+1 \\
            x^2+2x+\frac{7}{6} & x^2 + \frac{1}{6} & x^2-2x+\frac{7}{6}
        \end{array}
    \right]
    \left[
        \begin{array}{c}
            c_0 \\
            c_1 \\
            c_2 \\
        \end{array}
    \right]
    = 
    \left[
        \begin{array}{c}
            1 \\
            x \\ 
            x^2 \\
        \end{array}
    \right].
\end{equation}

Since this linear system holds for all \(x\), we can simply set \(x=0\)
and obtain the coefficients
\([c_0, c_1, c_2]^{T} = [ -\frac{1}{12}, \frac{7}{6}, -\frac{1}{12}]^T\).

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}5}]:} \PY{k}{def} \PY{n+nf}{generate\PYZus{}coeff}\PY{p}{(}\PY{n}{num}\PY{p}{,} \PY{n}{order}\PY{p}{,} \PY{n}{T}\PY{p}{)}\PY{p}{:}
            \PY{n}{Gpn} \PY{o}{=} \PY{n+nb}{int}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{ceil}\PY{p}{(}\PY{l+m+mf}{0.5}\PY{o}{*}\PY{p}{(}\PY{n}{num}\PY{o}{+}\PY{n}{order}\PY{p}{)}\PY{p}{)}\PY{p}{)}
            \PY{n}{xg}\PY{p}{,} \PY{n}{wg} \PY{o}{=} \PY{n}{npleg}\PY{o}{.}\PY{n}{leggauss}\PY{p}{(}\PY{n}{Gpn}\PY{p}{)}
            \PY{n}{A} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{p}{[}\PY{n}{num}\PY{p}{,}\PY{n}{num}\PY{p}{]}\PY{p}{)}
            \PY{n}{b} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{p}{[}\PY{n}{num}\PY{p}{]}\PY{p}{)}
            \PY{n}{b}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{=} \PY{l+m+mf}{1.}
            \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{num}\PY{p}{)}\PY{p}{:}
                \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{num}\PY{p}{)}\PY{p}{:}
                    \PY{k}{for} \PY{n}{l} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{order}\PY{p}{)}\PY{p}{:}
                        \PY{n}{xm} \PY{o}{=} \PY{l+m+mf}{0.5}\PY{o}{*}\PY{p}{(}\PY{n}{T}\PY{p}{[}\PY{n}{j}\PY{p}{,}\PY{n}{l}\PY{p}{]} \PY{o}{+} \PY{n}{T}\PY{p}{[}\PY{n}{j}\PY{p}{,}\PY{n}{l}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
                        \PY{n}{xr} \PY{o}{=} \PY{l+m+mf}{0.5}\PY{o}{*}\PY{p}{(}\PY{n}{T}\PY{p}{[}\PY{n}{j}\PY{p}{,}\PY{n}{l}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{T}\PY{p}{[}\PY{n}{j}\PY{p}{,}\PY{n}{l}\PY{p}{]}\PY{p}{)}
                        \PY{k}{for} \PY{n}{m} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{Gpn}\PY{p}{)}\PY{p}{:}
                            \PY{n}{A}\PY{p}{[}\PY{n}{i}\PY{p}{,}\PY{n}{j}\PY{p}{]} \PY{o}{+}\PY{o}{=} \PY{n}{xr}\PY{o}{*}\PY{n}{wg}\PY{p}{[}\PY{n}{m}\PY{p}{]}\PY{o}{*}\PY{n}{bspline}\PY{p}{(}\PY{n}{xm}\PY{o}{+}\PY{n}{xr}\PY{o}{*}\PY{n}{xg}\PY{p}{[}\PY{n}{m}\PY{p}{]}\PY{p}{,} \PYZbs{}
                                                       \PY{n}{order}\PY{p}{,} \PY{n}{T}\PY{p}{[}\PY{n}{j}\PY{p}{,}\PY{p}{:}\PY{p}{]}\PY{p}{)}\PY{o}{*} \PYZbs{}
                                    \PY{p}{(}\PY{o}{\PYZhy{}}\PY{n}{xr}\PY{o}{*}\PY{n}{xg}\PY{p}{[}\PY{n}{m}\PY{p}{]}\PY{o}{\PYZhy{}}\PY{n}{xm}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{n}{i}
            \PY{n}{c} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linalg}\PY{o}{.}\PY{n}{solve}\PY{p}{(}\PY{n}{A}\PY{p}{,}\PY{n}{b}\PY{p}{)}
            \PY{k}{return} \PY{n}{c}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}6}]:} \PY{k}{def} \PY{n+nf}{filter}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{num}\PY{p}{,} \PY{n}{order}\PY{p}{,} \PY{n}{T}\PY{p}{,} \PY{n}{c}\PY{p}{)}\PY{p}{:}
            \PY{n+nb}{sum} \PY{o}{=} \PY{l+m+mf}{0.}
            \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{num}\PY{p}{)}\PY{p}{:}
                \PY{n+nb}{sum} \PY{o}{+}\PY{o}{=} \PY{n}{c}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{*}\PY{n}{bspline}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{order}\PY{p}{,} \PY{n}{T}\PY{p}{[}\PY{n}{j}\PY{p}{,}\PY{p}{:}\PY{p}{]}\PY{p}{)}
            \PY{k}{return} \PY{n+nb}{sum}
        
        \PY{k}{def} \PY{n+nf}{plot\PYZus{}filter}\PY{p}{(}\PY{n}{num}\PY{p}{,} \PY{n}{order}\PY{p}{,} \PY{n}{T}\PY{p}{,} \PY{n}{c}\PY{p}{)}\PY{p}{:}
            \PY{n}{samples} \PY{o}{=} \PY{l+m+mi}{1001}
            \PY{n}{x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{T}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{T}\PY{p}{[}\PY{n}{num}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{order}\PY{p}{]}\PY{p}{,} \PY{n}{samples}\PY{p}{)}
            \PY{n}{y} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n}{samples}\PY{p}{)}
            \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{samples}\PY{p}{)}\PY{p}{:}
                \PY{n}{y}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n+nb}{filter}\PY{p}{(}\PY{n}{x}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{num}\PY{p}{,} \PY{n}{order}\PY{p}{,} \PY{n}{T}\PY{p}{,} \PY{n}{c}\PY{p}{)}
            \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{x}\PY{p}{,}\PY{n}{y}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{linewidth}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}7}]:} \PY{k}{def} \PY{n+nf}{original\PYZus{}filter}\PY{p}{(}\PY{n}{degree}\PY{p}{)}\PY{p}{:}
            \PY{n}{num} \PY{o}{=} \PY{l+m+mi}{2}\PY{o}{*}\PY{n}{degree} \PY{o}{+} \PY{l+m+mi}{1}
            \PY{n}{order} \PY{o}{=} \PY{n}{degree} \PY{o}{+} \PY{l+m+mi}{1}
        
            \PY{n}{T} \PY{o}{=} \PY{n}{generate\PYZus{}nodes\PYZus{}T}\PY{p}{(}\PY{n}{num}\PY{p}{,} \PY{n}{order}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}
            \PY{n}{c} \PY{o}{=} \PY{n}{generate\PYZus{}coeff}\PY{p}{(}\PY{n}{num}\PY{p}{,} \PY{n}{order}\PY{p}{,} \PY{n}{T}\PY{p}{)}
            \PY{n+nb}{print} \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Filter Coefficients:  }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{c}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
            \PY{c+c1}{\PYZsh{}plt.figure(figsize=(10,6))}
            \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{num}\PY{p}{)}\PY{p}{:}
                \PY{n}{plot\PYZus{}bspline}\PY{p}{(}\PY{n}{order}\PY{p}{,} \PY{n}{T}\PY{p}{[}\PY{n}{i}\PY{p}{,}\PY{p}{:}\PY{p}{]}\PY{p}{)}
            \PY{n}{plot\PYZus{}filter}\PY{p}{(}\PY{n}{num}\PY{p}{,} \PY{n}{order}\PY{p}{,} \PY{n}{T}\PY{p}{,} \PY{n}{c}\PY{p}{)}
            \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}x\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{16}\PY{p}{)}
            \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}K(x)\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{16}\PY{p}{)}
            \PY{n}{plt}\PY{o}{.}\PY{n}{xticks}\PY{p}{(}\PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{12}\PY{p}{)}
            \PY{n}{plt}\PY{o}{.}\PY{n}{yticks}\PY{p}{(}\PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{12}\PY{p}{)}
            \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Original Filter, \PYZdl{}k = }\PY{l+s+s1}{\PYZsq{}}\PY{o}{+}\PY{n+nb}{str}\PY{p}{(}\PY{n}{degree}\PY{p}{)}\PY{o}{+}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{18}\PY{p}{)}
            \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} to show on nbviewer online, comment out for running on a real server  }
        \PY{n}{original\PYZus{}filter}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Filter Coefficients:   [-0.08333333  1.16666667 -0.08333333] 


    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_14_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}8}]:} \PY{n}{w} \PY{o}{=} \PY{n}{interactive}\PY{p}{(}\PY{n}{original\PYZus{}filter}\PY{p}{,} \PY{n}{degree}\PY{o}{=}\PY{n}{widgets}\PY{o}{.}\PY{n}{IntSlider}\PY{p}{(}\PY{n+nb}{min}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}\PY{n+nb}{max}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{,}\PY{n}{value}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
        \PY{n}{display}\PY{p}{(}\PY{n}{w}\PY{p}{)}
\end{Verbatim}


    
    \begin{verbatim}
interactive(children=(IntSlider(value=1, description='degree', max=5, min=1), Output()), _dom_classes=('widget-interact',))
    \end{verbatim}

    
    \subsection{Filtering}\label{filtering}

    \subsubsection{DG Solution}\label{dg-solution}

In this tutorial, we do not include the DG codes. Instead, we will input
the DG solution, then apply the filtering. In the default setting, the
DG solution has form

\begin{equation}
    u_h(x) = \sum\limits_{j=1}^N\sum\limits_{l = 0}^k u_{l,j}\phi_j^l(x),
\end{equation}

where \(\left\{\phi_j^l\right\}_{l=0}^k\) is the standard Legendre
polynomial on the element
\(I_j = [x_{j-\frac{1}{2}},x_{j+\frac{1}{2}}]\). Coefficients
\(\left\{u_{l,j}\right\}\) are provided by data file,
\(DGsolution\_k?\_N?.dat\), with column-major order (\(l\)-major). This
data is computed for the linear equation

\begin{equation*}
   u_t + u_x = 0
\end{equation*}

on the uniform mesh for domain \([0,1]\) with exact solution
\[u(x,T) = \sin(2\pi(x-T))\] at \(T = 1\).

First of all, we define a function to read the DG data and return the
coefficients \(u[l,j]\)

\begin{Shaded}
\begin{Highlighting}[]
    \KeywordTok{def}\NormalTok{ Input_DG(EleNum, degree)}
\end{Highlighting}
\end{Shaded}

where - \(N\): the number of elements - \(k\): the polynomial degree of
DG basis

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}9}]:} \PY{k}{def} \PY{n+nf}{Input\PYZus{}DG}\PY{p}{(}\PY{n}{EleNum}\PY{p}{,} \PY{n}{degree}\PY{p}{)}\PY{p}{:}
            \PY{n}{u} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{loadtxt}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{DGdata/DGsolution\PYZus{}k}\PY{l+s+s2}{\PYZdq{}}\PY{o}{+}\PY{n+nb}{str}\PY{p}{(}\PY{n}{degree}\PY{p}{)}\PY{o}{+}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZus{}N}\PY{l+s+s2}{\PYZdq{}}\PY{o}{+}\PY{n+nb}{str}\PY{p}{(}\PY{n}{EleNum}\PY{p}{)}\PY{o}{+}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{.dat}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
            \PY{k}{return} \PY{n}{np}\PY{o}{.}\PY{n}{transpose}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{n}{u}\PY{p}{,}\PY{p}{[}\PY{n}{EleNum}\PY{p}{,}\PY{n}{degree}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    Before we apply the filtering, let us have a look of the error of DG
solutions. To do so, we have to define the Legendre basis function

\begin{Shaded}
\begin{Highlighting}[]
    \KeywordTok{def}\NormalTok{ LegendreBasis(x,degree)}
\end{Highlighting}
\end{Shaded}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}10}]:} \PY{k}{def} \PY{n+nf}{LegendreBasis}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{degree}\PY{p}{)}\PY{p}{:}
             \PY{n}{coeff} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n}{degree}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{coeff}\PY{p}{[}\PY{n}{degree}\PY{p}{]} \PY{o}{=} \PY{l+m+mf}{1.}
             \PY{k}{return} \PY{n}{npleg}\PY{o}{.}\PY{n}{legval}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{coeff}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}11}]:} \PY{k}{def} \PY{n+nf}{print\PYZus{}OrderTable}\PY{p}{(}\PY{n}{number\PYZus{}coarse}\PY{p}{,} \PY{n}{erri}\PY{p}{,} \PY{n}{err2}\PY{p}{)}\PY{p}{:}
             \PY{n+nb}{print} \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{  N  Linf norm order  L2 norm  order}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
             \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{size}\PY{p}{(}\PY{n}{erri}\PY{p}{)}\PY{p}{)}\PY{p}{:}
                 \PY{n}{N} \PY{o}{=} \PY{n}{number\PYZus{}coarse}\PY{o}{*}\PY{l+m+mi}{2}\PY{o}{*}\PY{o}{*}\PY{n}{i}
                 \PY{k}{if} \PY{p}{(}\PY{n}{i} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{:}
                     \PY{n+nb}{print} \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+si}{\PYZpc{}3d}\PY{l+s+s2}{  }\PY{l+s+si}{\PYZpc{}7.2e}\PY{l+s+s2}{   \PYZhy{}\PYZhy{}   }\PY{l+s+si}{\PYZpc{}7.2e}\PY{l+s+s2}{   \PYZhy{}\PYZhy{}}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PYZbs{}
                            \PY{p}{(}\PY{n}{N}\PY{p}{,} \PY{n}{erri}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{err2}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}\PY{p}{)}
                 \PY{k}{else}\PY{p}{:}
                     \PY{n+nb}{print} \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+si}{\PYZpc{}3d}\PY{l+s+s2}{  }\PY{l+s+si}{\PYZpc{}7.2e}\PY{l+s+s2}{  }\PY{l+s+si}{\PYZpc{}4.2f}\PY{l+s+s2}{  }\PY{l+s+si}{\PYZpc{}7.2e}\PY{l+s+s2}{  }\PY{l+s+si}{\PYZpc{}4.2f}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PYZbs{}
                                \PY{p}{(}\PY{n}{N}\PY{p}{,} \PYZbs{}
                                 \PY{n}{erri}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{erri}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{/}\PY{n}{erri}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}\PY{o}{/}\PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,}\PYZbs{}
                                 \PY{n}{err2}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{err2}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{/}\PY{n}{err2}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}\PY{o}{/}\PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}12}]:} \PY{k}{def} \PY{n+nf}{DG\PYZus{}order}\PY{p}{(}\PY{n}{number\PYZus{}coarse}\PY{p}{,} \PY{n}{degree}\PY{p}{)}\PY{p}{:}
             \PY{n}{Gpn} \PY{o}{=} \PY{l+m+mi}{6}
             \PY{n}{xg}\PY{p}{,} \PY{n}{wg} \PY{o}{=} \PY{n}{npleg}\PY{o}{.}\PY{n}{leggauss}\PY{p}{(}\PY{n}{Gpn}\PY{p}{)}
             \PY{n}{err2} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{l+m+mi}{4}\PY{p}{)}
             \PY{n}{erri} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{l+m+mi}{4}\PY{p}{)}
             \PY{n}{style} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{b.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{g\PYZhy{}.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{c\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
             
             \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{4}\PY{p}{)}\PY{p}{:}
                 \PY{n}{N} \PY{o}{=} \PY{n}{number\PYZus{}coarse}\PY{o}{*}\PY{l+m+mi}{2}\PY{o}{*}\PY{o}{*}\PY{p}{(}\PY{n}{i}\PY{p}{)}
                 \PY{n}{u} \PY{o}{=} \PY{n}{Input\PYZus{}DG}\PY{p}{(}\PY{n}{N}\PY{p}{,} \PY{n}{degree}\PY{p}{)}
                 \PY{n}{x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{n}{N}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}
                 \PY{n}{dx} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{n}{x}\PY{p}{)}
                 \PY{c+c1}{\PYZsh{}\PYZsh{} plotting}
                 \PY{n}{plot\PYZus{}x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{empty}\PY{p}{(}\PY{n}{N}\PY{o}{*}\PY{n}{Gpn}\PY{p}{)}
                 \PY{n}{plot\PYZus{}y} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{empty}\PY{p}{(}\PY{n}{N}\PY{o}{*}\PY{n}{Gpn}\PY{p}{)}
                 
                 \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{N}\PY{p}{)}\PY{p}{:}
                     \PY{k}{for} \PY{n}{m} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{Gpn}\PY{p}{)}\PY{p}{:}
                         \PY{n}{uh} \PY{o}{=} \PY{l+m+mf}{0.}
                         \PY{n}{xj} \PY{o}{=} \PY{p}{(}\PY{n}{x}\PY{p}{[}\PY{n}{j}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{+}\PY{n}{x}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{)}\PY{o}{/}\PY{l+m+mi}{2} \PY{o}{+} \PY{n}{dx}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{*}\PY{n}{xg}\PY{p}{[}\PY{n}{m}\PY{p}{]}\PY{o}{/}\PY{l+m+mi}{2}
                         \PY{k}{for} \PY{n}{l} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{degree}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:}
                             \PY{n}{uh} \PY{o}{+}\PY{o}{=} \PY{n}{u}\PY{p}{[}\PY{n}{l}\PY{p}{,}\PY{n}{j}\PY{p}{]}\PY{o}{*}\PY{n}{LegendreBasis}\PY{p}{(}\PY{n}{xg}\PY{p}{[}\PY{n}{m}\PY{p}{]}\PY{p}{,} \PY{n}{l}\PY{p}{)}
                         \PY{n}{err} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{sin}\PY{p}{(}\PY{l+m+mi}{2}\PY{o}{*}\PY{n}{np}\PY{o}{.}\PY{n}{pi}\PY{o}{*}\PY{n}{xj}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{n}{uh}\PY{p}{)}
                         \PY{n}{err2}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{+}\PY{o}{=} \PY{l+m+mf}{0.5}\PY{o}{*}\PY{n}{dx}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{*}\PY{n}{wg}\PY{p}{[}\PY{n}{m}\PY{p}{]}\PY{o}{*}\PY{n}{err}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}
                         \PY{n}{erri}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n+nb}{max}\PY{p}{(}\PY{n}{erri}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{err}\PY{p}{)}
                         
                         \PY{n}{plot\PYZus{}x}\PY{p}{[}\PY{n}{j}\PY{o}{*}\PY{n}{Gpn}\PY{o}{+}\PY{n}{m}\PY{p}{]} \PY{o}{=} \PY{n}{xj}
                         \PY{n}{plot\PYZus{}y}\PY{p}{[}\PY{n}{j}\PY{o}{*}\PY{n}{Gpn}\PY{o}{+}\PY{n}{m}\PY{p}{]} \PY{o}{=} \PY{n}{err}
                 \PY{n}{err2}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{err2}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{/}\PY{l+m+mf}{1.}\PY{p}{)}
                 \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{plot\PYZus{}x}\PY{p}{,} \PY{n}{plot\PYZus{}y}\PY{p}{,} \PY{n}{style}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,}\PY{n}{linewidth}\PY{o}{=}\PY{l+m+mf}{2.0}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{N = }\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{N}\PY{p}{)}\PY{p}{)}
             \PY{n}{print\PYZus{}OrderTable}\PY{p}{(}\PY{n}{number\PYZus{}coarse}\PY{p}{,} \PY{n}{erri}\PY{p}{,} \PY{n}{err2}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{yscale}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{log}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{14}\PY{p}{)}
             \PY{n}{ax}\PY{o}{.}\PY{n}{draw\PYZus{}frame}\PY{p}{(}\PY{k+kc}{False}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{xlim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}plt.ylim(1.e\PYZhy{}6,1.e0)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{18}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{|error|}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{18}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{} to show on nbviewer online, comment out for running on a real server }
         \PY{n}{DG\PYZus{}order}\PY{p}{(}\PY{l+m+mi}{20}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
  N  Linf norm order  L2 norm  order
 20  3.67e-04   --   1.07e-04   --
 40  4.62e-05  2.99  1.34e-05  3.00
 80  5.78e-06  3.00  1.67e-06  3.00
160  7.23e-07  3.00  2.09e-07  3.00

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_22_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}13}]:} \PY{n}{w} \PY{o}{=} \PY{n}{interactive}\PY{p}{(}\PY{n}{DG\PYZus{}order}\PY{p}{,} \PY{n}{number\PYZus{}coarse}\PY{o}{=}\PY{n}{fixed}\PY{p}{(}\PY{l+m+mi}{20}\PY{p}{)}\PY{p}{,} \PY{n}{degree}\PY{o}{=}\PY{n}{widgets}\PY{o}{.}\PY{n}{IntSlider}\PY{p}{(}\PY{n+nb}{min}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}\PY{n+nb}{max}\PY{o}{=}\PY{l+m+mi}{4}\PY{p}{,}\PY{n}{value}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
         \PY{n}{display}\PY{p}{(}\PY{n}{w}\PY{p}{)}
\end{Verbatim}


    
    \begin{verbatim}
interactive(children=(IntSlider(value=1, description='degree', max=4, min=1), Output()), _dom_classes=('widget-interact',))
    \end{verbatim}

    
    \textbf{Note:}

Actually, one can use numpy function

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    numpy.polynomial.legendre.legval(x, u[}\DecValTok{0}\NormalTok{:degree}\OperatorTok{+}\DecValTok{1}\NormalTok{,j])}
\end{Highlighting}
\end{Shaded}

to evaluate \(u_h\) directly. In fact, as a post-processing technique,
there is no need to know the basis functions information of the DG
solution. One only needs to know the evaluation of \(u_h(x)\). Of
course, in order to calculate the convolution properly, we still need
the mesh information of the DG method.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}14}]:} \PY{k}{def} \PY{n+nf}{point\PYZus{}location}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{grid}\PY{p}{)}\PY{p}{:}
             \PY{n}{tiny} \PY{o}{=} \PY{l+m+mf}{1.e\PYZhy{}10}
             \PY{c+c1}{\PYZsh{} assume periodic condition}
             \PY{n}{x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{mod}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}
             \PY{k}{for} \PY{n}{n} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{size}\PY{p}{(}\PY{n}{grid}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:}
                 \PY{k}{if} \PY{p}{(}\PY{n}{grid}\PY{p}{[}\PY{n}{n}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{tiny} \PY{o}{\PYZlt{}}\PY{o}{=} \PY{n}{x} \PY{o+ow}{and} \PY{n}{x} \PY{o}{\PYZlt{}}\PY{o}{=} \PY{n}{grid}\PY{p}{[}\PY{n}{n}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}}\PY{n}{tiny}\PY{p}{)}\PY{p}{:}
                     \PY{k}{return} \PY{n}{n}
             \PY{k}{return} \PY{n}{np}\PY{o}{.}\PY{n}{size}\PY{p}{(}\PY{n}{grid}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{l+m+mi}{2}
         
         \PY{k}{def} \PY{n+nf}{u\PYZus{}DG}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{element\PYZus{}index}\PY{p}{,} \PY{n}{u}\PY{p}{)}\PY{p}{:}
             \PY{k}{return} \PY{n}{npleg}\PY{o}{.}\PY{n}{legval}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{u}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{n}{element\PYZus{}index}\PY{p}{]}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}15}]:} \PY{c+c1}{\PYZsh{} to show on nbviewer online, comment out for running on a real server }
         \PY{n}{DG\PYZus{}order}\PY{p}{(}\PY{l+m+mi}{20}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
  N  Linf norm order  L2 norm  order
 20  3.67e-04   --   1.07e-04   --
 40  4.62e-05  2.99  1.34e-05  3.00
 80  5.78e-06  3.00  1.67e-06  3.00
160  7.23e-07  3.00  2.09e-07  3.00

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_26_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}16}]:} \PY{n}{w} \PY{o}{=} \PY{n}{interactive}\PY{p}{(}\PY{n}{DG\PYZus{}order}\PY{p}{,} \PY{n}{number\PYZus{}coarse}\PY{o}{=}\PY{n}{fixed}\PY{p}{(}\PY{l+m+mi}{20}\PY{p}{)}\PY{p}{,} \PY{n}{degree}\PY{o}{=}\PY{n}{widgets}\PY{o}{.}\PY{n}{IntSlider}\PY{p}{(}\PY{n+nb}{min}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}\PY{n+nb}{max}\PY{o}{=}\PY{l+m+mi}{4}\PY{p}{,}\PY{n}{value}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}
         \PY{n}{display}\PY{p}{(}\PY{n}{w}\PY{p}{)}
\end{Verbatim}


    
    \begin{verbatim}
interactive(children=(IntSlider(value=2, description='degree', max=4, min=1), Output()), _dom_classes=('widget-interact',))
    \end{verbatim}

    
    \subsubsection{Evaluation of the
Convolution}\label{evaluation-of-the-convolution}

\[ u_h^{\star}(x, T) = (K_H\star u_h)(x, T) = \int_{-\infty}^{\infty}K_H(x - \xi)u_h(\xi, T) d\xi, \]
The basic operation used in SIAC filtering is convolution of the DG
solution against a B-spline based filter. Here, we explicitly point out
the steps to efficient evaluation of the convolution operator. In the
one-dimensional case, denote \(\{I_j\}_{j=1}^N\) be the mesh of the DG
solution. * To calculate the integration, we first need to specify the
support range. The support size of the filter is decided by its nodes
matrix \(T\) that \(\text{K(x)} = \left[\min{T}, \max{T}\right]\).
Therefore, to evaluate the filtered solution at the point \(x \in I_j\),
we have

\begin{equation}
    \begin{split}
    u_h^\star(x) & = \frac{1}{H}\int_{-\infty}^\infty K^{(r,\ell)}\left(\frac{x - \xi}{H}\right)u_h(\xi) d\xi \\
               & = \frac{1}{H}\int_{x - H\cdot\max\{T\}}^{x- H\cdot\min\{T\}}K^{(r,\ell)}\left(\frac{x-\xi}{H}\right)u_h(\xi) d\xi
    \end{split}
\end{equation}

    \begin{itemize}
\tightlist
\item
  The above integration is calculated by Gauss quadrature with at least
  \(k+1\) quadrature points. However, both the DG solution and the
  filter are piecewise polynomials. Therefore, we have to divide the
  integration interval,
  \(\left[x - H\cdot\max\{T\}, x- H\cdot\min\{T\}\right]\) into many
  subintervals, such that both the DG solution and the filter are
  polynomials on each subinterval.

  \begin{itemize}
  \tightlist
  \item
    First, find the DG elements that involved in the integration, that
    \[A(x) = \left\{i:\quad I_i \cap \left[x - H\cdot\max\{T\}, x- H\cdot\min\{T\}\right] \neq \varnothing \right\},\]
    then we write the integration as\\
    \[u_h^\star(x) = \frac{1}{H}\sum\limits_{i \in A(x)} \int_{I_{i}}K^{(r,\ell)}\left(\frac{x-\xi}{H}\right)u_h(\xi) d\xi. \]
  \item
    Then we divide the elements \(I_i\) into several subintervals that
    \(I_i = \bigcup\limits_{\alpha=1}^{n_{i}}I_{i}^\alpha\) according to
    the breaks of the filter such that on each subinterval
    \(I_{i}^\alpha\) the filter is a polynomial, it leads

    \begin{equation}
    \begin{split}
    & \int_{I_{i}}K^{(r,\ell)}\left(\frac{x-\xi}{H}\right)u_h(\xi) d\xi \\
    = &\, \sum\limits_{\alpha=1}^{n_{i}}\int_{I_{i}^\alpha}K^{(r,\ell)}\left(\frac{x-\xi}{H}\right)u_h(\xi) d\xi.
    \end{split}
    \end{equation}
  \item
    Finally, we can apply the Gauss quadrature to calculate the
    integration on subintervals \(I_{i}^\alpha\).
  \end{itemize}
\end{itemize}

    \textbf{Note:} * For uniform meshes, we usually choose the uniform
element size \(h\) as the filter scaling, \(H = h\). Therefore, we only
need to divide each element \(I_{i}\) into two subintervals. * For
nonuniform meshes, the scaling and the number of subintervals is
dependent on the mesh. To speed up the filtering process, sometimes it
is possible to use inexact integration. However, first step is
necessary. * In multi-dimensions, the filter is a tensor product of the
one-dimensional filters. The implementation of the multi-dimensional
SIAC filter over rectangular meshes is the same. For triangular meshes,
the principles are the same and one can find the details in another
\href{}{notebook}.

    \subsubsection{Step by Step Python
Implementation}\label{step-by-step-python-implementation}

In previous section, we have discussed the algorithm Now, let us
implementing the filtering step by step.

\begin{itemize}
\item
  \textbf{Filter Nodes}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{def}\NormalTok{ generate_filter_nodes(T):}
        \OperatorTok{---}
    \ControlFlowTok{return}\NormalTok{ filter_nodes}
\end{Highlighting}
\end{Shaded}

  the \(filter\_nodes\) stores all the nodes of the filter, which is the
  union of the nodes of all used B-splines.

  \begin{itemize}
  \tightlist
  \item
    Be aware that the nodes may be float numbers, it is not safe to use
    np.unique directly.
  \end{itemize}
\end{itemize}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}17}]:} \PY{k}{def} \PY{n+nf}{generate\PYZus{}filter\PYZus{}nodes}\PY{p}{(}\PY{n}{T}\PY{p}{)}\PY{p}{:}
             \PY{n}{tiny} \PY{o}{=} \PY{l+m+mf}{1.e\PYZhy{}13}
             \PY{n}{filter\PYZus{}nodes} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{n}{np}\PY{o}{.}\PY{n}{min}\PY{p}{(}\PY{n}{T}\PY{p}{)}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{n}{T}\PY{p}{)}\PY{p}{]}\PY{p}{)}
             \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{size}\PY{p}{(}\PY{n}{T}\PY{p}{,}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{)}\PY{p}{:}
                 \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{size}\PY{p}{(}\PY{n}{T}\PY{p}{,}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}\PY{p}{:}
                     \PY{k}{for} \PY{n}{m} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{size}\PY{p}{(}\PY{n}{filter\PYZus{}nodes}\PY{p}{)}\PY{p}{)}\PY{p}{:}
                         \PY{k}{if} \PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{filter\PYZus{}nodes}\PY{p}{[}\PY{n}{m}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{T}\PY{p}{[}\PY{n}{j}\PY{p}{,}\PY{n}{i}\PY{p}{]}\PY{p}{)} \PY{o}{\PYZlt{}} \PY{n}{tiny}\PY{p}{)}\PY{p}{:}
                             \PY{k}{break}
                         \PY{k}{if} \PY{p}{(}\PY{n}{filter\PYZus{}nodes}\PY{p}{[}\PY{n}{m}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{T}\PY{p}{[}\PY{n}{j}\PY{p}{,}\PY{n}{i}\PY{p}{]} \PY{o}{\PYZgt{}} \PY{n}{tiny}\PY{p}{)}\PY{p}{:}
                             \PY{n}{filter\PYZus{}nodes} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{insert}\PY{p}{(}\PY{n}{filter\PYZus{}nodes}\PY{p}{,} \PY{n}{m}\PY{p}{,} \PY{n}{T}\PY{p}{[}\PY{n}{j}\PY{p}{,}\PY{n}{i}\PY{p}{]}\PY{p}{)}
                             \PY{k}{break}
             \PY{k}{return} \PY{n}{filter\PYZus{}nodes}
\end{Verbatim}


    \begin{itemize}
\item
  \textbf{Involved DG Elements}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{def}\NormalTok{ generate_index_Ax(x, grid, T, H):}
        \OperatorTok{---}
    \ControlFlowTok{return}\NormalTok{ Ax}
\end{Highlighting}
\end{Shaded}

  This function will return the index of the elements which are involved
  for filtering point \(x\),
  \[A(x) = \left\{i:\quad I_i \cap \left[x - H\cdot\max\{T\}, x- H\cdot\min\{T\}\right] \neq \varnothing \right\}.\]

  \begin{itemize}
  \tightlist
  \item
    If \(x\) is near the boundary, the above support interval may not
    totally belong to the DG domain. In this situation, the index
    returned will processed by periodic assumption.
  \end{itemize}
\end{itemize}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}18}]:} \PY{k}{def} \PY{n+nf}{generate\PYZus{}index\PYZus{}Ax}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{grid}\PY{p}{,} \PY{n}{T}\PY{p}{,} \PY{n}{H}\PY{p}{)}\PY{p}{:}
             \PY{n}{left\PYZus{}index}  \PY{o}{=} \PY{n}{point\PYZus{}location}\PY{p}{(}\PY{n}{x} \PY{o}{\PYZhy{}} \PY{n}{H}\PY{o}{*}\PY{n}{np}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{n}{T}\PY{p}{)}\PY{p}{,} \PY{n}{grid}\PY{p}{)}
             \PY{n}{right\PYZus{}index} \PY{o}{=} \PY{n}{point\PYZus{}location}\PY{p}{(}\PY{n}{x} \PY{o}{\PYZhy{}} \PY{n}{H}\PY{o}{*}\PY{n}{np}\PY{o}{.}\PY{n}{min}\PY{p}{(}\PY{n}{T}\PY{p}{)}\PY{p}{,} \PY{n}{grid}\PY{p}{)}
             \PY{k}{if} \PY{p}{(}\PY{n}{left\PYZus{}index} \PY{o}{\PYZlt{}}\PY{o}{=} \PY{n}{right\PYZus{}index}\PY{p}{)}\PY{p}{:}
                 \PY{n}{Ax} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{arange}\PY{p}{(}\PY{n}{left\PYZus{}index}\PY{p}{,} \PY{n}{right\PYZus{}index}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{k}{else}\PY{p}{:} \PY{c+c1}{\PYZsh{}near boundary}
                 \PY{n}{Ax} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{concatenate}\PY{p}{(}\PY{p}{[}\PY{n}{np}\PY{o}{.}\PY{n}{arange}\PY{p}{(}\PY{n}{left\PYZus{}index}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{size}\PY{p}{(}\PY{n}{grid}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,}\PY{n}{np}\PY{o}{.}\PY{n}{arange}\PY{p}{(}\PY{n}{right\PYZus{}index}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{]}\PY{p}{)}
             \PY{k}{return} \PY{n}{Ax}
\end{Verbatim}


    \begin{itemize}
\item
  \textbf{Subintervals for Quadrature}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{def}\NormalTok{ generate_subintervals_local(i, grid, filter_nodes):}
        \OperatorTok{---}
    \ControlFlowTok{return}\NormalTok{ interfaces}
\end{Highlighting}
\end{Shaded}

  With the given DG element index \(i\), this function will divide
  element \(I_i\) into subintervals according to the \(filter_nodes\).
  It returns the interfaces of all the subintervals which are also the
  subintervals for using Gauss quadrature to compute the integration.
\end{itemize}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}19}]:} \PY{k}{def} \PY{n+nf}{generate\PYZus{}subintervals\PYZus{}local}\PY{p}{(}\PY{n}{i}\PY{p}{,} \PY{n}{grid}\PY{p}{,} \PY{n}{filter\PYZus{}nodes}\PY{p}{)}\PY{p}{:}
             \PY{n}{interfaces} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{n}{grid}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,}\PY{n}{grid}\PY{p}{[}\PY{n}{i}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{]}\PY{p}{)}
             \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{size}\PY{p}{(}\PY{n}{filter\PYZus{}nodes}\PY{p}{)}\PY{p}{)}\PY{p}{:}
                 \PY{k}{if} \PY{p}{(}\PY{n}{grid}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{\PYZlt{}} \PY{n}{filter\PYZus{}nodes}\PY{p}{[}\PY{n}{j}\PY{p}{]} \PY{o+ow}{and} \PY{n}{filter\PYZus{}nodes}\PY{p}{[}\PY{n}{j}\PY{p}{]} \PY{o}{\PYZlt{}} \PY{n}{grid}\PY{p}{[}\PY{n}{i}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{:}
                     \PY{n}{interfaces} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{insert}\PY{p}{(}\PY{n}{interfaces}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{filter\PYZus{}nodes}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{)}
             \PY{k}{return} \PY{n}{interfaces}
\end{Verbatim}


    \begin{itemize}
\item
  \textbf{Computing the Convolution}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{def}\NormalTok{ Gauss_convolution_filter_DG(xj, T, c, filter_nodes, H, grid, u, xg, wg):}
        \OperatorTok{---}
    \ControlFlowTok{return}\NormalTok{ ustar}
\end{Highlighting}
\end{Shaded}

  Now, we have all the ingredients to calculate the convolution of the
  filter and the DG solution, let us put them together.

  \begin{itemize}
  \tightlist
  \item
    One important reminder is that the support interval of the
    convolution operator has been processed periodically, so the
    evaluation of the filter value need to be processed in the same way
    too.
  \item
    The filter coefficients \(c\) and nodes \(filter\_nodes\) can be
    computed from the node matrix \(T\) directly. However, they are
    fixed in this tutorial, so one can calculate them before and store
    the values.
  \item
    Also, the gauss quadrature points \(xg\) and weight \(wg\) can be
    either provided by outside of the function, or defined inside the
    function. Whatever, to calculate the integration exactly, the points
    number should \(\geq degree+1\).
  \end{itemize}
\end{itemize}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}20}]:} \PY{k}{def} \PY{n+nf}{Gauss\PYZus{}convolution\PYZus{}filter\PYZus{}DG}\PY{p}{(}\PY{n}{xj}\PY{p}{,} \PY{n}{T}\PY{p}{,} \PY{n}{c}\PY{p}{,} \PY{n}{filter\PYZus{}nodes}\PY{p}{,} \PY{n}{H}\PY{p}{,} \PY{n}{grid}\PY{p}{,} \PY{n}{u}\PY{p}{,} \PY{n}{xg}\PY{p}{,} \PY{n}{wg}\PY{p}{)}\PY{p}{:}
             \PY{n}{Ax} \PY{o}{=} \PY{n}{generate\PYZus{}index\PYZus{}Ax}\PY{p}{(}\PY{n}{xj}\PY{p}{,} \PY{n}{grid}\PY{p}{,} \PY{n}{T}\PY{p}{,} \PY{n}{H}\PY{p}{)}
             \PY{n}{filter\PYZus{}nodes\PYZus{}local} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{mod}\PY{p}{(}\PY{n}{xj} \PY{o}{\PYZhy{}} \PY{n}{H}\PY{o}{*}\PY{n}{filter\PYZus{}nodes}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{num} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{size}\PY{p}{(}\PY{n}{T}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
             \PY{n}{order} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{size}\PY{p}{(}\PY{n}{T}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}
             \PY{n}{N} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{size}\PY{p}{(}\PY{n}{grid}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}
             
             \PY{n}{ustar} \PY{o}{=} \PY{l+m+mf}{0.}
             \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{size}\PY{p}{(}\PY{n}{Ax}\PY{p}{)}\PY{p}{)}\PY{p}{:}
                 \PY{n}{i} \PY{o}{=} \PY{n}{Ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}
                 \PY{n}{h} \PY{o}{=} \PY{n}{grid}\PY{p}{[}\PY{n}{i}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{grid}\PY{p}{[}\PY{n}{i}\PY{p}{]}
                 \PY{n}{interfaces} \PY{o}{=} \PY{n}{generate\PYZus{}subintervals\PYZus{}local}\PY{p}{(}\PY{n}{i}\PY{p}{,} \PY{n}{grid}\PY{p}{,} \PY{n}{filter\PYZus{}nodes\PYZus{}local}\PY{p}{)}
                 \PY{k}{for} \PY{n}{alpha} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{size}\PY{p}{(}\PY{n}{interfaces}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:}
                     \PY{n}{mid}   \PY{o}{=} \PY{l+m+mf}{0.5}\PY{o}{*}\PY{p}{(}\PY{n}{interfaces}\PY{p}{[}\PY{n}{alpha}\PY{p}{]} \PY{o}{+} \PY{n}{interfaces}\PY{p}{[}\PY{n}{alpha}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
                     \PY{n}{scale} \PY{o}{=} \PY{l+m+mf}{0.5}\PY{o}{*}\PY{p}{(}\PY{n}{interfaces}\PY{p}{[}\PY{n}{alpha}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{interfaces}\PY{p}{[}\PY{n}{alpha}\PY{p}{]}\PY{p}{)}
                     \PY{k}{for} \PY{n}{mm} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{size}\PY{p}{(}\PY{n}{xg}\PY{p}{)}\PY{p}{)}\PY{p}{:}
                         \PY{n}{quad\PYZus{}x} \PY{o}{=} \PY{n}{mid} \PY{o}{+} \PY{n}{scale}\PY{o}{*}\PY{n}{xg}\PY{p}{[}\PY{n}{mm}\PY{p}{]}
                         \PY{n}{filter\PYZus{}x} \PY{o}{=} \PY{p}{(}\PY{n}{xj} \PY{o}{\PYZhy{}} \PY{n}{quad\PYZus{}x}\PY{p}{)}\PY{o}{/}\PY{n}{H}
                         \PY{k}{if} \PY{p}{(}\PY{n}{filter\PYZus{}x} \PY{o}{\PYZlt{}} \PY{n}{np}\PY{o}{.}\PY{n}{min}\PY{p}{(}\PY{n}{T}\PY{p}{)}\PY{p}{)}\PY{p}{:}
                             \PY{n}{filter\PYZus{}x} \PY{o}{+}\PY{o}{=} \PY{n}{N}
                         \PY{k}{elif} \PY{p}{(}\PY{n}{filter\PYZus{}x} \PY{o}{\PYZgt{}} \PY{n}{np}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{n}{T}\PY{p}{)}\PY{p}{)}\PY{p}{:}
                             \PY{n}{filter\PYZus{}x} \PY{o}{+}\PY{o}{=} \PY{o}{\PYZhy{}}\PY{n}{N}
                         \PY{n}{ustar} \PY{o}{+}\PY{o}{=} \PY{n}{scale}\PY{o}{*}\PY{n}{wg}\PY{p}{[}\PY{n}{mm}\PY{p}{]}\PY{o}{*}\PY{n+nb}{filter}\PY{p}{(}\PY{n}{filter\PYZus{}x}\PY{p}{,} \PY{n}{num}\PY{p}{,} \PY{n}{order}\PY{p}{,} \PY{n}{T}\PY{p}{,} \PY{n}{c}\PY{p}{)}\PY{o}{*}\PYZbs{}
                             \PY{n}{u\PYZus{}DG}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{2}\PY{o}{*}\PY{n}{quad\PYZus{}x} \PY{o}{\PYZhy{}} \PY{p}{(}\PY{n}{grid}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{+}\PY{n}{grid}\PY{p}{[}\PY{n}{i}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{o}{/}\PY{n}{h}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{u}\PY{p}{)}
             \PY{k}{return} \PY{l+m+mi}{1}\PY{o}{/}\PY{n}{H}\PY{o}{*}\PY{n}{ustar}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}21}]:} \PY{k}{def} \PY{n+nf}{generate\PYZus{}filter}\PY{p}{(}\PY{n}{degree}\PY{p}{)}\PY{p}{:}
             \PY{n}{num} \PY{o}{=} \PY{l+m+mi}{2}\PY{o}{*}\PY{n}{degree}\PY{o}{+}\PY{l+m+mi}{1}
             \PY{n}{order} \PY{o}{=} \PY{n}{degree}\PY{o}{+}\PY{l+m+mi}{1}
             
             \PY{n}{T} \PY{o}{=} \PY{n}{generate\PYZus{}nodes\PYZus{}T}\PY{p}{(}\PY{n}{num}\PY{p}{,} \PY{n}{order}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{c} \PY{o}{=} \PY{n}{generate\PYZus{}coeff}\PY{p}{(}\PY{n}{num}\PY{p}{,} \PY{n}{order}\PY{p}{,} \PY{n}{T}\PY{p}{)}
             \PY{n}{filter\PYZus{}nodes} \PY{o}{=} \PY{n}{generate\PYZus{}filter\PYZus{}nodes}\PY{p}{(}\PY{n}{T}\PY{p}{)}
             
             \PY{k}{return} \PY{n}{T}\PY{p}{,} \PY{n}{c}\PY{p}{,} \PY{n}{filter\PYZus{}nodes}
\end{Verbatim}


    \subsubsection{Filtered Solution}\label{filtered-solution}

Now, we have implemented the filtering, let us see the performance.

\textbf{Note:} Due to the precision issue, in this tutorial, the
filtered results for \(N = 160\) with \(\mathbb{P}^3\) polynomials and
\(N = 80, 160\) with \($\mathbb{P}^4\) polynomials are contaminated.
Since NumPy does not provide a data type with more precision than C long
doubles, we will not addressed this issue in this tutorial. However, we
believe it is already enough for a demonstration purpose.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}22}]:} \PY{k}{def} \PY{n+nf}{Filter\PYZus{}order}\PY{p}{(}\PY{n}{number\PYZus{}coarse}\PY{p}{,} \PY{n}{degree}\PY{p}{)}\PY{p}{:}
             \PY{c+c1}{\PYZsh{} gauss points for plotting, computing norm error }
             \PY{n}{Gpn} \PY{o}{=} \PY{l+m+mi}{6}
             \PY{n}{xg}\PY{p}{,} \PY{n}{wg} \PY{o}{=} \PY{n}{npleg}\PY{o}{.}\PY{n}{leggauss}\PY{p}{(}\PY{n}{Gpn}\PY{p}{)}
             \PY{c+c1}{\PYZsh{} gauss points for computing convolution, the number should \PYZgt{}= degree+1}
             \PY{n}{Gpn2} \PY{o}{=} \PY{n}{degree}\PY{o}{+}\PY{l+m+mi}{1}
             \PY{n}{xg2}\PY{p}{,} \PY{n}{wg2} \PY{o}{=} \PY{n}{npleg}\PY{o}{.}\PY{n}{leggauss}\PY{p}{(}\PY{n}{Gpn2}\PY{p}{)}
             \PY{n}{levels}\PY{o}{=}\PY{l+m+mi}{4}\PY{p}{;} \PY{n}{err2} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{l+m+mi}{4}\PY{p}{)}\PY{p}{;} \PY{n}{erri} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{l+m+mi}{4}\PY{p}{)}\PY{p}{;}
             \PY{c+c1}{\PYZsh{} plotting style}
             \PY{n}{style} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{b.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{g\PYZhy{}.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{c\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
             
             \PY{c+c1}{\PYZsh{} generating the filter}
             \PY{n}{T}\PY{p}{,} \PY{n}{c}\PY{p}{,} \PY{n}{filter\PYZus{}nodes} \PY{o}{=} \PY{n}{generate\PYZus{}filter}\PY{p}{(}\PY{n}{degree}\PY{p}{)}
             
             \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{levels}\PY{p}{)}\PY{p}{:}
                 \PY{n}{N} \PY{o}{=} \PY{n}{number\PYZus{}coarse}\PY{o}{*}\PY{l+m+mi}{2}\PY{o}{*}\PY{o}{*}\PY{p}{(}\PY{n}{i}\PY{p}{)}
                 \PY{n}{u} \PY{o}{=} \PY{n}{Input\PYZus{}DG}\PY{p}{(}\PY{n}{N}\PY{p}{,} \PY{n}{degree}\PY{p}{)}
                 \PY{n}{x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{n}{N}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}
                 \PY{n}{dx} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{n}{x}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} plotting}
                 \PY{n}{plot\PYZus{}x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{empty}\PY{p}{(}\PY{n}{N}\PY{o}{*}\PY{n}{Gpn}\PY{p}{)}\PY{p}{;} \PY{n}{plot\PYZus{}y} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{empty}\PY{p}{(}\PY{n}{N}\PY{o}{*}\PY{n}{Gpn}\PY{p}{)}\PY{p}{;} 
                 
                 \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{N}\PY{p}{)}\PY{p}{:}
                     \PY{n}{H} \PY{o}{=} \PY{n}{dx}\PY{p}{[}\PY{n}{j}\PY{p}{]}
                     \PY{k}{for} \PY{n}{m} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{Gpn}\PY{p}{)}\PY{p}{:}
                         \PY{n}{xj} \PY{o}{=} \PY{p}{(}\PY{n}{x}\PY{p}{[}\PY{n}{j}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{+}\PY{n}{x}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{)}\PY{o}{/}\PY{l+m+mi}{2} \PY{o}{+} \PY{n}{dx}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{*}\PY{n}{xg}\PY{p}{[}\PY{n}{m}\PY{p}{]}\PY{o}{/}\PY{l+m+mi}{2}
                         
                         \PY{n}{ustar} \PY{o}{=} \PY{n}{Gauss\PYZus{}convolution\PYZus{}filter\PYZus{}DG}\PY{p}{(}\PY{n}{xj}\PY{p}{,} \PY{n}{T}\PY{p}{,} \PY{n}{c}\PY{p}{,} \PY{n}{filter\PYZus{}nodes}\PY{p}{,} \PY{n}{H}\PY{p}{,} \PY{n}{x}\PY{p}{,} \PY{n}{u}\PY{p}{,} \PY{n}{xg2}\PY{p}{,} \PY{n}{wg2}\PY{p}{)}
                         
                         \PY{n}{err} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{sin}\PY{p}{(}\PY{l+m+mi}{2}\PY{o}{*}\PY{n}{np}\PY{o}{.}\PY{n}{pi}\PY{o}{*}\PY{n}{xj}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{n}{ustar}\PY{p}{)}
                         \PY{n}{err2}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{+}\PY{o}{=} \PY{l+m+mf}{0.5}\PY{o}{*}\PY{n}{dx}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{*}\PY{n}{wg}\PY{p}{[}\PY{n}{m}\PY{p}{]}\PY{o}{*}\PY{n}{err}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}
                         \PY{n}{erri}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n+nb}{max}\PY{p}{(}\PY{n}{erri}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{err}\PY{p}{)}
                         \PY{c+c1}{\PYZsh{} plotting}
                         \PY{n}{plot\PYZus{}x}\PY{p}{[}\PY{n}{j}\PY{o}{*}\PY{n}{Gpn}\PY{o}{+}\PY{n}{m}\PY{p}{]} \PY{o}{=} \PY{n}{xj}\PY{p}{;} \PY{n}{plot\PYZus{}y}\PY{p}{[}\PY{n}{j}\PY{o}{*}\PY{n}{Gpn}\PY{o}{+}\PY{n}{m}\PY{p}{]} \PY{o}{=} \PY{n}{err}
                 \PY{n}{err2}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{err2}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{/}\PY{l+m+mf}{1.}\PY{p}{)}
                 \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{plot\PYZus{}x}\PY{p}{,} \PY{n}{plot\PYZus{}y}\PY{p}{,} \PY{n}{style}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,}\PY{n}{linewidth}\PY{o}{=}\PY{l+m+mf}{2.0}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{N = }\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{N}\PY{p}{)}\PY{p}{)}
             \PY{n}{print\PYZus{}OrderTable}\PY{p}{(}\PY{n}{number\PYZus{}coarse}\PY{p}{,} \PY{n}{erri}\PY{p}{,} \PY{n}{err2}\PY{p}{)}
             
             \PY{n}{plt}\PY{o}{.}\PY{n}{yscale}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{log}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{n}{loc}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{,}\PY{n}{frameon}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{14}\PY{p}{)}\PY{p}{;} 
             \PY{n}{plt}\PY{o}{.}\PY{n}{xlim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{;} \PY{c+c1}{\PYZsh{}plt.ylim(1.e\PYZhy{}6,1.e0)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{18}\PY{p}{)}\PY{p}{;} \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{|error|}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{18}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{} to show on nbviewer online, comment out for running on a real server }
         \PY{n}{Filter\PYZus{}order}\PY{p}{(}\PY{l+m+mi}{20}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
  N  Linf norm order  L2 norm  order
 20  5.81e-06   --   4.10e-06   --
 40  1.33e-07  5.45  9.42e-08  5.44
 80  3.39e-09  5.30  2.40e-09  5.30
160  9.38e-11  5.18  6.63e-11  5.18

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_41_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}23}]:} \PY{n}{w} \PY{o}{=} \PY{n}{interactive}\PY{p}{(}\PY{n}{Filter\PYZus{}order}\PY{p}{,} \PY{n}{number\PYZus{}coarse}\PY{o}{=}\PY{n}{fixed}\PY{p}{(}\PY{l+m+mi}{20}\PY{p}{)}\PY{p}{,} \PY{n}{degree}\PY{o}{=}\PY{n}{widgets}\PY{o}{.}\PY{n}{IntSlider}\PY{p}{(}\PY{n+nb}{min}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}\PY{n+nb}{max}\PY{o}{=}\PY{l+m+mi}{4}\PY{p}{,}\PY{n}{value}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}
         \PY{n}{display}\PY{p}{(}\PY{n}{w}\PY{p}{)}
\end{Verbatim}


    
    \begin{verbatim}
interactive(children=(IntSlider(value=2, description='degree', max=4, min=1), Output()), _dom_classes=('widget-interact',))
    \end{verbatim}

    
    \subsubsection{DG Solution vs. Filtered
Solution}\label{dg-solution-vs.-filtered-solution}

During previous sections, one can already see the advantages of the
filtered solution over the DG solution. Here, to give a easier view, we
put the results together for comparison.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}24}]:} \PY{k}{def} \PY{n+nf}{DGvsFilter\PYZus{}order}\PY{p}{(}\PY{n}{number\PYZus{}coarse}\PY{p}{,} \PY{n}{degree}\PY{p}{)}\PY{p}{:}
             \PY{c+c1}{\PYZsh{} gauss points for plotting, computing norm error }
             \PY{n}{Gpn} \PY{o}{=} \PY{l+m+mi}{6}
             \PY{n}{xg}\PY{p}{,} \PY{n}{wg} \PY{o}{=} \PY{n}{npleg}\PY{o}{.}\PY{n}{leggauss}\PY{p}{(}\PY{n}{Gpn}\PY{p}{)}
             \PY{c+c1}{\PYZsh{} gauss points for computing convolution, the number should \PYZgt{}= degree+1}
             \PY{n}{Gpn2} \PY{o}{=} \PY{n}{degree}\PY{o}{+}\PY{l+m+mi}{1}
             \PY{n}{xg2}\PY{p}{,} \PY{n}{wg2} \PY{o}{=} \PY{n}{npleg}\PY{o}{.}\PY{n}{leggauss}\PY{p}{(}\PY{n}{Gpn2}\PY{p}{)}
             \PY{n}{levels}\PY{o}{=}\PY{l+m+mi}{4}\PY{p}{;} \PY{n}{err2\PYZus{}dg} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{l+m+mi}{4}\PY{p}{)}\PY{p}{;} \PY{n}{erri\PYZus{}dg} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{l+m+mi}{4}\PY{p}{)}\PY{p}{;} \PY{n}{err2\PYZus{}filter} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{l+m+mi}{4}\PY{p}{)}\PY{p}{;} \PY{n}{erri\PYZus{}filter} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{l+m+mi}{4}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} plotting style}
             \PY{n}{style} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{b.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{g\PYZhy{}.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{c\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
             \PY{n}{fig} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,}\PY{l+m+mi}{4}\PY{p}{)}\PY{p}{)}
             \PY{n}{fig}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
             \PY{n}{ax1} \PY{o}{=} \PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}subplot}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{ax2} \PY{o}{=} \PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}subplot}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} generating the filter}
             \PY{n}{T}\PY{p}{,} \PY{n}{c}\PY{p}{,} \PY{n}{filter\PYZus{}nodes} \PY{o}{=} \PY{n}{generate\PYZus{}filter}\PY{p}{(}\PY{n}{degree}\PY{p}{)}
             
             \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{levels}\PY{p}{)}\PY{p}{:}
                 \PY{n}{N} \PY{o}{=} \PY{n}{number\PYZus{}coarse}\PY{o}{*}\PY{l+m+mi}{2}\PY{o}{*}\PY{o}{*}\PY{p}{(}\PY{n}{i}\PY{p}{)}
                 \PY{n}{u} \PY{o}{=} \PY{n}{Input\PYZus{}DG}\PY{p}{(}\PY{n}{N}\PY{p}{,} \PY{n}{degree}\PY{p}{)}
                 \PY{n}{x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{n}{N}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}
                 \PY{n}{dx} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{n}{x}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} plotting}
                 \PY{n}{plot\PYZus{}x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{empty}\PY{p}{(}\PY{n}{N}\PY{o}{*}\PY{n}{Gpn}\PY{p}{)}\PY{p}{;} \PY{n}{plot\PYZus{}dg} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{empty}\PY{p}{(}\PY{n}{N}\PY{o}{*}\PY{n}{Gpn}\PY{p}{)}\PY{p}{;} \PY{n}{plot\PYZus{}filtered} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{empty}\PY{p}{(}\PY{n}{N}\PY{o}{*}\PY{n}{Gpn}\PY{p}{)}
                 
                 \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{N}\PY{p}{)}\PY{p}{:}
                     \PY{n}{H} \PY{o}{=} \PY{n}{dx}\PY{p}{[}\PY{n}{j}\PY{p}{]}
                     \PY{k}{for} \PY{n}{m} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{Gpn}\PY{p}{)}\PY{p}{:}
                         \PY{n}{xj} \PY{o}{=} \PY{p}{(}\PY{n}{x}\PY{p}{[}\PY{n}{j}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{+}\PY{n}{x}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{)}\PY{o}{/}\PY{l+m+mi}{2} \PY{o}{+} \PY{n}{dx}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{*}\PY{n}{xg}\PY{p}{[}\PY{n}{m}\PY{p}{]}\PY{o}{/}\PY{l+m+mi}{2}
                         
                         \PY{n}{uh} \PY{o}{=} \PY{n}{u\PYZus{}DG}\PY{p}{(}\PY{n}{xg}\PY{p}{[}\PY{n}{m}\PY{p}{]}\PY{p}{,} \PY{n}{j}\PY{p}{,} \PY{n}{u}\PY{p}{)}
                         \PY{n}{ustar} \PY{o}{=} \PY{n}{Gauss\PYZus{}convolution\PYZus{}filter\PYZus{}DG}\PY{p}{(}\PY{n}{xj}\PY{p}{,} \PY{n}{T}\PY{p}{,} \PY{n}{c}\PY{p}{,} \PY{n}{filter\PYZus{}nodes}\PY{p}{,} \PY{n}{H}\PY{p}{,} \PY{n}{x}\PY{p}{,} \PY{n}{u}\PY{p}{,} \PY{n}{xg2}\PY{p}{,} \PY{n}{wg2}\PY{p}{)}
                         
                         \PY{n}{err\PYZus{}dg} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{sin}\PY{p}{(}\PY{l+m+mi}{2}\PY{o}{*}\PY{n}{np}\PY{o}{.}\PY{n}{pi}\PY{o}{*}\PY{n}{xj}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{n}{uh}\PY{p}{)}
                         \PY{n}{err\PYZus{}filter} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{sin}\PY{p}{(}\PY{l+m+mi}{2}\PY{o}{*}\PY{n}{np}\PY{o}{.}\PY{n}{pi}\PY{o}{*}\PY{n}{xj}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{n}{ustar}\PY{p}{)}
                         
                         \PY{n}{err2\PYZus{}dg}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{+}\PY{o}{=} \PY{l+m+mf}{0.5}\PY{o}{*}\PY{n}{dx}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{*}\PY{n}{wg}\PY{p}{[}\PY{n}{m}\PY{p}{]}\PY{o}{*}\PY{n}{err\PYZus{}dg}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}
                         \PY{n}{erri\PYZus{}dg}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n+nb}{max}\PY{p}{(}\PY{n}{erri\PYZus{}dg}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{err\PYZus{}dg}\PY{p}{)}
                         \PY{n}{err2\PYZus{}filter}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{+}\PY{o}{=} \PY{l+m+mf}{0.5}\PY{o}{*}\PY{n}{dx}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{*}\PY{n}{wg}\PY{p}{[}\PY{n}{m}\PY{p}{]}\PY{o}{*}\PY{n}{err\PYZus{}filter}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}
                         \PY{n}{erri\PYZus{}filter}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n+nb}{max}\PY{p}{(}\PY{n}{erri\PYZus{}filter}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{err\PYZus{}filter}\PY{p}{)}
                         \PY{c+c1}{\PYZsh{} plotting}
                         \PY{n}{plot\PYZus{}x}\PY{p}{[}\PY{n}{j}\PY{o}{*}\PY{n}{Gpn}\PY{o}{+}\PY{n}{m}\PY{p}{]} \PY{o}{=} \PY{n}{xj}\PY{p}{;} \PY{n}{plot\PYZus{}dg}\PY{p}{[}\PY{n}{j}\PY{o}{*}\PY{n}{Gpn}\PY{o}{+}\PY{n}{m}\PY{p}{]} \PY{o}{=} \PY{n}{err\PYZus{}dg}\PY{p}{;} \PY{n}{plot\PYZus{}filtered}\PY{p}{[}\PY{n}{j}\PY{o}{*}\PY{n}{Gpn}\PY{o}{+}\PY{n}{m}\PY{p}{]} \PY{o}{=} \PY{n}{err\PYZus{}filter}\PY{p}{;}
                 \PY{n}{err2\PYZus{}dg}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{err2\PYZus{}dg}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{/}\PY{l+m+mf}{1.}\PY{p}{)}
                 \PY{n}{erri\PYZus{}dg}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{erri\PYZus{}dg}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{/}\PY{l+m+mf}{1.}\PY{p}{)}
                 \PY{k}{if} \PY{p}{(}\PY{n}{i} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{:}
                     \PY{n}{y\PYZus{}max} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{n}{plot\PYZus{}dg}\PY{p}{)}
                 \PY{k}{if} \PY{p}{(}\PY{n}{i} \PY{o}{==} \PY{n}{levels}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:}
                     \PY{n}{y\PYZus{}min} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{min}\PY{p}{(}\PY{n}{plot\PYZus{}filtered}\PY{p}{)}
                 \PY{n}{ax1}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{plot\PYZus{}x}\PY{p}{,} \PY{n}{plot\PYZus{}dg}\PY{p}{,} \PY{n}{style}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,}\PY{n}{linewidth}\PY{o}{=}\PY{l+m+mf}{2.0}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{N = }\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{N}\PY{p}{)}\PY{p}{)}
                 \PY{n}{ax2}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{plot\PYZus{}x}\PY{p}{,} \PY{n}{plot\PYZus{}filtered}\PY{p}{,} \PY{n}{style}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,}\PY{n}{linewidth}\PY{o}{=}\PY{l+m+mf}{2.0}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{N = }\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{N}\PY{p}{)}\PY{p}{)}
             \PY{n+nb}{print} \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{DG error: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
             \PY{n}{print\PYZus{}OrderTable}\PY{p}{(}\PY{n}{number\PYZus{}coarse}\PY{p}{,} \PY{n}{erri\PYZus{}dg}\PY{p}{,} \PY{n}{err2\PYZus{}dg}\PY{p}{)}
             \PY{n+nb}{print} \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{Filtered error: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
             \PY{n}{print\PYZus{}OrderTable}\PY{p}{(}\PY{n}{number\PYZus{}coarse}\PY{p}{,} \PY{n}{erri\PYZus{}filter}\PY{p}{,} \PY{n}{err2\PYZus{}filter}\PY{p}{)}
             
             \PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}yscale}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{log}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}yscale}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{log}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{ax1}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{n}{frameon}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}\PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{12}\PY{p}{)}
             \PY{n}{ax2}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{n}{frameon}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}\PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{12}\PY{p}{)}
             \PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{;} \PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}ylim}\PY{p}{(}\PY{n}{y\PYZus{}min}\PY{p}{,}\PY{n}{y\PYZus{}max}\PY{p}{)}
             \PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{;} \PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}ylim}\PY{p}{(}\PY{n}{y\PYZus{}min}\PY{p}{,}\PY{n}{y\PYZus{}max}\PY{p}{)}
             \PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{16}\PY{p}{)}\PY{p}{;} \PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{|error|}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{16}\PY{p}{)}
             \PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{16}\PY{p}{)}\PY{p}{;} \PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{|error|}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{16}\PY{p}{)}
             \PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{DG errors, degree = }\PY{l+s+si}{\PYZpc{}1d}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n}{degree}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{16}\PY{p}{)}
             \PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Filtered errors, degree = }\PY{l+s+si}{\PYZpc{}1d}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n}{degree}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{16}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{} to show on nbviewer online, comment out for running on a real server }
         \PY{n}{DGvsFilter\PYZus{}order}\PY{p}{(}\PY{l+m+mi}{20}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
DG error: 
  N  Linf norm order  L2 norm  order
 20  1.92e-02   --   1.07e-04   --
 40  6.80e-03  1.50  1.34e-05  3.00
 80  2.40e-03  1.50  1.67e-06  3.00
160  8.50e-04  1.50  2.09e-07  3.00

Filtered error: 
  N  Linf norm order  L2 norm  order
 20  5.81e-06   --   1.68e-11   --
 40  1.33e-07  5.45  8.87e-15  10.89
 80  3.39e-09  5.30  5.74e-18  10.59
160  9.38e-11  5.18  4.39e-21  10.35

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_44_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}25}]:} \PY{n}{w} \PY{o}{=} \PY{n}{interactive}\PY{p}{(}\PY{n}{DGvsFilter\PYZus{}order}\PY{p}{,} \PY{n}{number\PYZus{}coarse}\PY{o}{=}\PY{n}{fixed}\PY{p}{(}\PY{l+m+mi}{20}\PY{p}{)}\PY{p}{,} \PY{n}{degree}\PY{o}{=}\PY{n}{widgets}\PY{o}{.}\PY{n}{IntSlider}\PY{p}{(}\PY{n+nb}{min}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}\PY{n+nb}{max}\PY{o}{=}\PY{l+m+mi}{4}\PY{p}{,}\PY{n}{value}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}
         \PY{n}{display}\PY{p}{(}\PY{n}{w}\PY{p}{)}
\end{Verbatim}


    
    \begin{verbatim}
interactive(children=(IntSlider(value=2, description='degree', max=4, min=1), Output()), _dom_classes=('widget-interact',))
    \end{verbatim}

    
    \subsubsection{Efficiency}\label{efficiency}

This tutorial is written for demonstration the idea, so the codes are
not optimized for computing speed. However, we note that if one has a
look at the main function

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    Gauss_convolution_filter_DG(xj, T, c, filter_nodes, H, grid, u, xg, wg)}
\end{Highlighting}
\end{Shaded}

Clearly, for computing the filtered solution at different points, it
does not need information from the filtered solution. In other word, if
one has an ideal parallel computing resource, the computational time of
evaluating massive nodes will equal to evaluating a node, which is
negligible.

    \subsection{Features of SIAC
Filtering}\label{features-of-siac-filtering}

    \subsection{A Code to Play}\label{a-code-to-play}

In the end, we provide a code you can play with your own codes to see
how the filtering can improve your results. It does not matter you are
using the DG codes, FEM codes, IGA codes, FVM codes, etc., the code
should still work. However, the performance may be varying according to
the methods (the best performance comes from the DG methods). We will
discuss the difference in another \href{}{notebook}, but it is
interesting to test your code to see what happens.

For the following codes, you need provide the data of your numerical
solutions, the grid, the number of elements, degree of the basis
functions and a nodes sequence that you want to improve. \textbf{Note:}
you may have to change the either the following code or your data
structure a little bit.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}26}]:} \PY{k}{def} \PY{n+nf}{Filtering}\PY{p}{(}\PY{n}{N}\PY{p}{,} \PY{n}{degree}\PY{p}{,} \PY{n}{nodes}\PY{p}{)}\PY{p}{:}
             \PY{c+c1}{\PYZsh{} gauss points for computing convolution, the number should \PYZgt{}= degree+1 }
             \PY{n}{Gpn} \PY{o}{=} \PY{n}{degree}\PY{o}{+}\PY{l+m+mi}{1}
             \PY{n}{xg}\PY{p}{,} \PY{n}{wg} \PY{o}{=} \PY{n}{npleg}\PY{o}{.}\PY{n}{leggauss}\PY{p}{(}\PY{n}{Gpn}\PY{p}{)}
             \PY{n}{err\PYZus{}dg} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{size}\PY{p}{(}\PY{n}{nodes}\PY{p}{)}\PY{p}{)}\PY{p}{;} \PY{n}{err\PYZus{}filtered} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{size}\PY{p}{(}\PY{n}{nodes}\PY{p}{)}\PY{p}{)}\PY{p}{;} 
             
             \PY{c+c1}{\PYZsh{} generating the filter}
             \PY{n}{T}\PY{p}{,} \PY{n}{c}\PY{p}{,} \PY{n}{filter\PYZus{}nodes} \PY{o}{=} \PY{n}{generate\PYZus{}filter}\PY{p}{(}\PY{n}{degree}\PY{p}{)}
             
             \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{size}\PY{p}{(}\PY{n}{nodes}\PY{p}{)}\PY{p}{)}\PY{p}{:}
                 \PY{n}{u} \PY{o}{=} \PY{n}{Input\PYZus{}DG}\PY{p}{(}\PY{n}{N}\PY{p}{,} \PY{n}{degree}\PY{p}{)}
                 \PY{n}{x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{n}{N}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}
                 \PY{n}{dx} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{n}{x}\PY{p}{)}
                 
                 \PY{n}{xj} \PY{o}{=} \PY{n}{nodes}\PY{p}{[}\PY{n}{i}\PY{p}{]}
                 \PY{n}{j} \PY{o}{=} \PY{n}{point\PYZus{}location}\PY{p}{(}\PY{n}{xj}\PY{p}{,} \PY{n}{x}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} original numerical solution}
                 \PY{n}{uh} \PY{o}{=} \PY{n}{u\PYZus{}DG}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{2}\PY{o}{*}\PY{n}{xj} \PY{o}{\PYZhy{}} \PY{p}{(}\PY{n}{x}\PY{p}{[}\PY{n}{j}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{+}\PY{n}{x}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{o}{/}\PY{n}{dx}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{,} \PY{n}{j}\PY{p}{,} \PY{n}{u}\PY{p}{)}
                 \PY{n}{err\PYZus{}dg}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{sin}\PY{p}{(}\PY{l+m+mi}{2}\PY{o}{*}\PY{n}{np}\PY{o}{.}\PY{n}{pi}\PY{o}{*}\PY{n}{xj}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{n}{uh}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} filtered solution}
                 \PY{n}{H} \PY{o}{=} \PY{n}{dx}\PY{p}{[}\PY{n}{j}\PY{p}{]}
                 \PY{n}{ustar} \PY{o}{=} \PY{n}{Gauss\PYZus{}convolution\PYZus{}filter\PYZus{}DG}\PY{p}{(}\PY{n}{xj}\PY{p}{,} \PY{n}{T}\PY{p}{,} \PY{n}{c}\PY{p}{,} \PY{n}{filter\PYZus{}nodes}\PY{p}{,} \PY{n}{H}\PY{p}{,} \PY{n}{x}\PY{p}{,} \PY{n}{u}\PY{p}{,} \PY{n}{xg}\PY{p}{,} \PY{n}{wg}\PY{p}{)}   
                 \PY{n}{err\PYZus{}filtered}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{sin}\PY{p}{(}\PY{l+m+mi}{2}\PY{o}{*}\PY{n}{np}\PY{o}{.}\PY{n}{pi}\PY{o}{*}\PY{n}{xj}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{n}{ustar}\PY{p}{)}
                         
         
             \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{nodes}\PY{p}{,} \PY{n}{err\PYZus{}dg}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k\PYZhy{}.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{linewidth}\PY{o}{=}\PY{l+m+mf}{2.0}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{DG error}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{nodes}\PY{p}{,} \PY{n}{err\PYZus{}filtered}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r\PYZhy{}.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{linewidth}\PY{o}{=}\PY{l+m+mf}{2.0}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Filtered error}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
             \PY{n+nb}{print} \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{The maximum error at the given nodes: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
             \PY{n+nb}{print} \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{DG error:        }\PY{l+s+si}{\PYZpc{}7.2e}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}}  \PY{n}{np}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{n}{err\PYZus{}dg}\PY{p}{)}\PY{p}{)}
             \PY{n+nb}{print} \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Filtered error:  }\PY{l+s+si}{\PYZpc{}7.2e}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}}  \PY{n}{np}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{n}{err\PYZus{}filtered}\PY{p}{)}\PY{p}{)}
         
             \PY{n}{plt}\PY{o}{.}\PY{n}{yscale}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{log}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{xlim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{n}{frameon}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}\PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{12}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{16}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{|error|}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{16}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \_\_ A test example:\_\_

The following code will generate the nodes sequence by all the
Gauss-Legendre points on each elements. \textbf{Note:} the default dates
come with this tutorial only support \(N = 20, 40, 80, 160\) and
\(degree = 1, 2, 3, 4\).

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}27}]:} \PY{k}{def} \PY{n+nf}{Filtering\PYZus{}Gauss}\PY{p}{(}\PY{n}{N}\PY{p}{,} \PY{n}{degree}\PY{p}{,} \PY{n}{Gpn}\PY{p}{)}\PY{p}{:}
             \PY{n}{xg}\PY{p}{,}\PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{npleg}\PY{o}{.}\PY{n}{leggauss}\PY{p}{(}\PY{n}{Gpn}\PY{p}{)}
             \PY{n}{nodes} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n}{N}\PY{o}{*}\PY{n}{Gpn}\PY{p}{)}
             \PY{n}{grid} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{n}{N}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{N}\PY{p}{)}\PY{p}{:}
                 \PY{n}{nodes}\PY{p}{[}\PY{n}{Gpn}\PY{o}{*}\PY{n}{i}\PY{p}{:}\PY{n}{Gpn}\PY{o}{*}\PY{p}{(}\PY{n}{i}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{]} \PY{o}{=} \PY{l+m+mf}{0.5}\PY{o}{*}\PY{p}{(}\PY{n}{grid}\PY{p}{[}\PY{n}{i}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{+}\PY{n}{grid}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)} \PY{o}{+} \PY{l+m+mf}{0.5}\PY{o}{*}\PY{n}{xg}\PY{o}{*}\PY{p}{(}\PY{n}{grid}\PY{p}{[}\PY{n}{i}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{\PYZhy{}}\PY{n}{grid}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}
             \PY{n}{Filtering}\PY{p}{(}\PY{n}{N}\PY{p}{,} \PY{n}{degree}\PY{p}{,} \PY{n}{nodes}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{} to show on nbviewer online, comment out for running on a real server }
         \PY{n}{Filtering\PYZus{}Gauss}\PY{p}{(}\PY{l+m+mi}{40}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
The maximum error at the given nodes: 
DG error:        4.62e-05
Filtered error:  1.33e-07

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_51_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}28}]:} \PY{n}{w} \PY{o}{=} \PY{n}{interactive}\PY{p}{(}\PY{n}{Filtering\PYZus{}Gauss}\PY{p}{,} \PYZbs{}
                         \PY{n}{N}\PY{o}{=}\PY{n}{widgets}\PY{o}{.}\PY{n}{IntText}\PY{p}{(}\PY{n}{value}\PY{o}{=}\PY{l+m+mi}{40}\PY{p}{,} \PY{n}{description}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Number of Elements:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{diaabled}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}\PY{p}{,} \PYZbs{}
                         \PY{n}{degree}\PY{o}{=}\PY{n}{widgets}\PY{o}{.}\PY{n}{IntText}\PY{p}{(}\PY{n}{value}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}\PY{n}{description}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Degree:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{disabled}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}\PY{p}{,} \PYZbs{}
                         \PY{n}{Gpn}\PY{o}{=}\PY{n}{widgets}\PY{o}{.}\PY{n}{IntText}\PY{p}{(}\PY{n}{value}\PY{o}{=}\PY{l+m+mi}{6}\PY{p}{,} \PY{n}{description}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Gauss Points:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{disabled}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}\PY{p}{)}
         \PY{n}{display}\PY{p}{(}\PY{n}{w}\PY{p}{)}
\end{Verbatim}


    
    \begin{verbatim}
interactive(children=(IntText(value=40, description='Number of Elements:'), IntText(value=2, description='Degree:'), IntText(value=6, description='Gauss Points:'), Output()), _dom_classes=('widget-interact',))
    \end{verbatim}

    
    \section{References}\label{references}

(de Boor, 2001) Carl de Boor, ``\emph{A practical guide to splines}'',
2001.

(Bramble and Schatz, 1977) Bramble J. H. and Schatz A. H.,
``\emph{Higher order local accuracy by averaging in the finite element
method}'', Math. Comp., vol. 31, number 137, pp. 94-\/-111, 1977.

(Cockburn, Luskin et al., 2003) Cockburn Bernardo, Luskin Mitchell and
Shu Endre, ``\emph{Enhanced accuracy by post-processing for finite
element methods for hyperbolic equations}'', Math. Comp., vol. 72,
number 242, pp. 577-\/-606, 2003.
\href{http://dx.doi.org/10.1090/S0025-5718-02-01464-3}{online}

(Li, 2015) Xiaozhou Li, ``\emph{Smoothness-Increasing and
Accuracy-Conserving (SIAC) Filters for Discontinuous Galerkin
Methods.}'', 2015.


    % Add a bibliography block to the postdoc
    
    
    
    \end{document}
